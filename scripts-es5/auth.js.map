{"version":3,"sources":["../scripts/auth.js"],"names":["window","friendlyPix","Auth","_waitForAuthPromiseResolver","promise","database","firebase","auth","$","Deferred","document","ready","signedInUserContainer","signedInUserAvatar","signedInUsername","signOutButton","deleteAccountButton","usernameLink","updateAll","click","signOut","deleteAccount","updateAllAccounts","onAuthStateChanged","user","router","reloadPage","resolve","body","classList","remove","userId","css","firebaseUi","start","uiConfig","add","uid","photoURL","text","displayName","attr","updatePublicProfile","currentUser","delete","then","alert","catch","error","code","updateAllProfiles","functions","httpsCallable","console","message"],"mappings":"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","file":"auth.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the user auth flows and updating the UI depending on the auth state.\n */\nfriendlyPix.Auth = class {\n\n  /**\n   * Returns a Promise that completes when auth is ready.\n   * @return Promise\n   */\n  get waitForAuth() {\n    return this._waitForAuthPromiseResolver.promise();\n  }\n\n  /**\n   * Initializes Friendly Pix's auth.\n   * Binds the auth related UI components and handles the auth flow.\n   * @constructor\n   */\n  constructor() {\n    // Firebase SDK\n    this.database = firebase.database();\n    this.auth = firebase.auth();\n    this._waitForAuthPromiseResolver = new $.Deferred();\n\n    $(document).ready(() => {\n      // Pointers to DOM Elements\n      const signedInUserContainer = $('.fp-signed-in-user-container');\n      this.signedInUserAvatar = $('.fp-avatar', signedInUserContainer);\n      this.signedInUsername = $('.fp-username', signedInUserContainer);\n      this.signOutButton = $('.fp-sign-out');\n      this.deleteAccountButton = $('.fp-delete-account');\n      this.usernameLink = $('.fp-usernamelink');\n      this.updateAll = $('.fp-update-all');\n\n      // Event bindings\n      this.signOutButton.click(() => this.auth.signOut());\n      this.deleteAccountButton.click(() => this.deleteAccount());\n      this.updateAll.click(() => this.updateAllAccounts());\n    });\n\n    this.auth.onAuthStateChanged(user => this.onAuthStateChanged(user));\n  }\n\n  /**\n   * Displays the signed-in user information in the UI or hides it and displays the\n   * \"Sign-In\" button if the user isn't signed-in.\n   */\n  onAuthStateChanged(user) {\n    if (window.friendlyPix.router) {\n      window.friendlyPix.router.reloadPage();\n    }\n    this._waitForAuthPromiseResolver.resolve();\n    $(document).ready(() => {\n      document.body.classList.remove('fp-auth-state-unknown');\n      if (!user) {\n        this.userId = null;\n        this.signedInUserAvatar.css('background-image', '');\n        firebaseUi.start('#firebaseui-auth-container', uiConfig);\n        document.body.classList.remove('fp-signed-in');\n        document.body.classList.add('fp-signed-out');\n      } else {\n        document.body.classList.remove('fp-signed-out');\n        document.body.classList.add('fp-signed-in');\n        this.userId = user.uid;\n        this.signedInUserAvatar.css('background-image',\n            `url(\"${user.photoURL || '/images/silhouette.jpg'}\")`);\n        this.signedInUsername.text(user.displayName || 'Anonymous');\n        this.usernameLink.attr('href', `/user/${user.uid}`);\n        friendlyPix.firebase.updatePublicProfile();\n      }\n    });\n  }\n\n  deleteAccount() {\n    this.auth.currentUser.delete().then(() => {\n      window.alert('Account deleted');\n    }).catch(error => {\n      if (error.code === 'auth/requires-recent-login') {\n        window.alert(\n          'You need to have recently signed-in to delete your account.\\n' +\n            'Please sign-in and try again.');\n        this.auth.signOut();\n      }\n    });\n  }\n\n  updateAllAccounts() {\n    const updateAllProfiles = firebase.functions().httpsCallable('updateAllProfiles');\n    updateAllProfiles().then(() => {\n      window.alert('Profiles update Finished successfully.');\n    }).catch(error => {\n      console.error('Error updating user profiles.', error);\n      window.alert('Error updating user profiles: ' + error.message);\n    });\n  }\n};\n\nfriendlyPix.auth = new friendlyPix.Auth();\n"]}