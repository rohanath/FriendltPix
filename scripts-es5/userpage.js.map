{"version":3,"sources":["../scripts/userpage.js"],"names":["window","friendlyPix","UserPage","database","firebase","auth","$","document","ready","userPage","userAvatar","toast","userUsername","userInfoContainer","followContainer","noPosts","followLabel","followCheckbox","blockContainer","blockLabel","blockCheckbox","nbPostsContainer","nbFollowers","nbFollowing","nbFollowingContainer","followingContainer","nextPageButton","closeFollowingButton","userInfoPageImageContainer","change","onFollowChange","onBlockChange","onAuthStateChanged","trackFollowStatus","trackBlockStatus","click","displayFollowing","hide","removeClass","checked","prop","toggleFollowUser","userId","toggleBlockUser","currentUser","registerToFollowStatusUpdate","data","val","text","MaterialUtils","refreshSwitchState","registerToBlockedStatusUpdate","posts","postIds","Object","keys","i","length","append","createImageCard","thumb_url","url","nextPage","show","unbind","then","addPosts","entries","toggleNextPageButton","clear","uid","messaging","enableNotificationsContainer","enableNotificationsCheckbox","trackNotificationsEnabledStatus","loadUserProfile","userInfo","snapshot","css","profile_picture","full_name","message","timeout","MaterialSnackbar","showSnackbar","page","registerForFollowersCount","registerForFollowingCount","nbFollowed","registerForPostsCount","nbPosts","getUserFeedPosts","subscribeToUserFeed","postId","postValue","prepend","registerForPostsDeletion","remove","getFollowingProfiles","profiles","forEach","createProfileCardHtml","addClass","cancelAllSubscriptions","stopOnEndScrolls","thumbUrl","element","attr","replace","registerForLikesCount","nbLikes","registerForCommentsCount","nbComments","profilePic","fullName","escapeHtml"],"mappings":"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","file":"userpage.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the User Profile UI.\n */\nfriendlyPix.UserPage = class {\n\n  /**\n   * Initializes the user's profile UI.\n   * @constructor\n   */\n  constructor() {\n    // Firebase SDK.\n    this.database = firebase.database();\n    this.auth = firebase.auth();\n\n    $(document).ready(() => {\n      // DOM Elements.\n      this.userPage = $('#page-user-info');\n      this.userAvatar = $('.fp-user-avatar');\n      this.toast = $('.mdl-js-snackbar');\n      this.userUsername = $('.fp-user-username');\n      this.userInfoContainer = $('.fp-user-container');\n      this.followContainer = $('.fp-follow');\n      this.noPosts = $('.fp-no-posts', this.userPage);\n      this.followLabel = $('.mdl-switch__label', this.followContainer);\n      this.followCheckbox = $('#follow');\n      this.blockContainer = $('.fp-block');\n      this.blockLabel = $('.mdl-switch__label', this.blockContainer);\n      this.blockCheckbox = $('#block');\n      this.nbPostsContainer = $('.fp-user-nbposts', this.userPage);\n      this.nbFollowers = $('.fp-user-nbfollowers', this.userPage);\n      this.nbFollowing = $('.fp-user-nbfollowing', this.userPage);\n      this.nbFollowingContainer = $('.fp-user-nbfollowing-container', this.userPage);\n      this.followingContainer = $('.fp-user-following', this.userPage);\n      this.nextPageButton = $('.fp-next-page-button button');\n      this.closeFollowingButton = $('.fp-close-following', this.userPage);\n      this.userInfoPageImageContainer = $('.fp-image-container', this.userPage);\n\n      // Event bindings.\n      this.followCheckbox.change(() => this.onFollowChange());\n      this.blockCheckbox.change(() => this.onBlockChange());\n      this.auth.onAuthStateChanged(() => this.trackFollowStatus());\n      this.auth.onAuthStateChanged(() => this.trackBlockStatus());\n      this.nbFollowingContainer.click(() => this.displayFollowing());\n      this.closeFollowingButton.click(() => {\n        this.followingContainer.hide();\n        this.nbFollowingContainer.removeClass('is-active');\n      });\n    });\n  }\n\n  /**\n   * Triggered when the user changes the \"Follow\" checkbox.\n   */\n  onFollowChange() {\n    const checked = this.followCheckbox.prop('checked');\n    this.followCheckbox.prop('disabled', true);\n\n    friendlyPix.firebase.toggleFollowUser(this.userId, checked);\n  }\n\n  /**\n   * Triggered when the user changes the \"Block\" checkbox.\n   */\n  onBlockChange() {\n    const checked = this.blockCheckbox.prop('checked');\n    this.blockCheckbox.prop('disabled', true);\n\n    friendlyPix.firebase.toggleBlockUser(this.userId, checked);\n  }\n\n  /**\n   * Starts tracking the \"Follow\" checkbox status.\n   */\n  trackFollowStatus() {\n    if (this.auth.currentUser) {\n      friendlyPix.firebase.registerToFollowStatusUpdate(this.userId, data => {\n        this.followCheckbox.prop('checked', data.val() !== null);\n        this.followCheckbox.prop('disabled', false);\n        this.followLabel.text(data.val() ? 'Following' : 'Follow');\n        friendlyPix.MaterialUtils.refreshSwitchState(this.followContainer);\n      });\n    }\n  }\n\n  /**\n   * Starts tracking the \"Blocked\" checkbox status.\n   */\n  trackBlockStatus() {\n    if (this.auth.currentUser) {\n      friendlyPix.firebase.registerToBlockedStatusUpdate(this.userId, data => {\n        this.blockCheckbox.prop('checked', data.val() !== null);\n        this.blockCheckbox.prop('disabled', false);\n        this.blockLabel.text(data.val() ? 'Blocked' : 'Block');\n        friendlyPix.MaterialUtils.refreshSwitchState(this.blockContainer);\n      });\n    }\n  }\n\n  /**\n   * Adds the list of posts to the UI.\n   */\n  addPosts(posts) {\n    const postIds = Object.keys(posts);\n    for (let i = postIds.length - 1; i >= 0; i--) {\n      this.userInfoPageImageContainer.append(\n          friendlyPix.UserPage.createImageCard(postIds[i],\n              posts[postIds[i]].thumb_url || posts[postIds[i]].url, posts[postIds[i]].text));\n      this.noPosts.hide();\n    }\n  }\n\n  /**\n   * Shows the \"load next page\" button and binds it the `nextPage` callback. If `nextPage` is `null`\n   * then the button is hidden.\n   */\n  toggleNextPageButton(nextPage) {\n    if (nextPage) {\n      this.nextPageButton.show();\n      this.nextPageButton.unbind('click');\n      this.nextPageButton.prop('disabled', false);\n      this.nextPageButton.click(() => {\n        this.nextPageButton.prop('disabled', true);\n        nextPage().then(data => {\n          this.addPosts(data.entries);\n          this.toggleNextPageButton(data.nextPage);\n        });\n      });\n    } else {\n      this.nextPageButton.hide();\n    }\n  }\n\n  /**\n   * Displays the given user information in the UI.\n   */\n  loadUser(userId) {\n    this.userId = userId;\n\n    // Reset the UI.\n    this.clear();\n\n    // If users is the currently signed-in user we hide the \"Follow\" checkbox and the opposite for\n    // the \"Notifications\" checkbox.\n    if (this.auth.currentUser && userId === this.auth.currentUser.uid) {\n      this.followContainer.hide();\n      this.blockContainer.hide();\n      friendlyPix.messaging.enableNotificationsContainer.show();\n      friendlyPix.messaging.enableNotificationsCheckbox.prop('disabled', true);\n      friendlyPix.MaterialUtils.refreshSwitchState(friendlyPix.messaging.enableNotificationsContainer);\n      friendlyPix.messaging.trackNotificationsEnabledStatus();\n    } else {\n      friendlyPix.messaging.enableNotificationsContainer.hide();\n      this.followContainer.show();\n      this.followCheckbox.prop('disabled', true);\n      this.blockContainer.show();\n      this.blockContainer.prop('disabled', true);\n      friendlyPix.MaterialUtils.refreshSwitchState(this.followContainer);\n      // Start live tracking the state of the \"Follow\" Checkbox.\n      this.trackFollowStatus();\n      // Start live tracking the state of the \"Block\" Checkbox.\n      this.trackBlockStatus();\n    }\n\n    // Load user's profile.\n    friendlyPix.firebase.loadUserProfile(userId).then(snapshot => {\n      const userInfo = snapshot.val();\n      if (userInfo) {\n        this.userAvatar.css('background-image',\n            `url(\"${userInfo.profile_picture || '/images/silhouette.jpg'}\")`);\n        this.userUsername.text(userInfo.full_name || 'Anonymous');\n        this.userInfoContainer.show();\n      } else {\n        var data = {\n          message: 'This user does not exists.',\n          timeout: 5000\n        };\n        this.toast[0].MaterialSnackbar.showSnackbar(data);\n        page(`/feed`);\n      }\n    });\n\n    // Lod user's number of followers.\n    friendlyPix.firebase.registerForFollowersCount(userId,\n        nbFollowers => this.nbFollowers.text(nbFollowers));\n\n    // Lod user's number of followed users.\n    friendlyPix.firebase.registerForFollowingCount(userId,\n        nbFollowed => this.nbFollowing.text(nbFollowed));\n\n    // Lod user's number of posts.\n    friendlyPix.firebase.registerForPostsCount(userId,\n        nbPosts => this.nbPostsContainer.text(nbPosts));\n\n    // Display user's posts.\n    friendlyPix.firebase.getUserFeedPosts(userId).then(data => {\n      const postIds = Object.keys(data.entries);\n      if (postIds.length === 0) {\n        this.noPosts.show();\n      }\n      friendlyPix.firebase.subscribeToUserFeed(userId,\n        (postId, postValue) => {\n          this.userInfoPageImageContainer.prepend(\n              friendlyPix.UserPage.createImageCard(postId,\n                  postValue.thumb_url || postValue.url, postValue.text));\n          this.noPosts.hide();\n        }, postIds[postIds.length - 1]);\n\n      // Adds fetched posts and next page button if necessary.\n      this.addPosts(data.entries);\n      this.toggleNextPageButton(data.nextPage);\n    });\n\n    // Listen for posts deletions.\n    friendlyPix.firebase.registerForPostsDeletion(postId =>\n        $(`.fp-post-${postId}`, this.userPage).remove());\n  }\n\n  /**\n   * Displays the list of followed people.\n   */\n  displayFollowing() {\n    friendlyPix.firebase.getFollowingProfiles(this.userId).then(profiles => {\n      // Clear previous following list.\n      $('.fp-usernamelink', this.followingContainer).remove();\n      // Display all following profile cards.\n      Object.keys(profiles).forEach(uid => this.followingContainer.prepend(\n          friendlyPix.UserPage.createProfileCardHtml(\n              uid, profiles[uid].profile_picture, profiles[uid].full_name)));\n      if (Object.keys(profiles).length > 0) {\n        this.followingContainer.show();\n        // Mark submenu as active.\n        this.nbFollowingContainer.addClass('is-active');\n      }\n    });\n  }\n\n  /**\n   * Clears the UI and listeners.\n   */\n  clear() {\n    // Removes all pics.\n    $('.fp-image', this.userInfoPageImageContainer).remove();\n\n    // Remove active states of sub menu selectors (like \"Following\").\n    $('.is-active', this.userInfoPageImageContainer).removeClass('is-active');\n\n    // Cancel all Firebase listeners.\n    friendlyPix.firebase.cancelAllSubscriptions();\n\n    // Hides the \"Load Next Page\" button.\n    this.nextPageButton.hide();\n\n    // Hides the user info box.\n    this.userInfoContainer.hide();\n\n    // Hide and empty the list of Followed people.\n    this.followingContainer.hide();\n    $('.fp-usernamelink', this.followingContainer).remove();\n\n    // Stops then infinite scrolling listeners.\n    friendlyPix.MaterialUtils.stopOnEndScrolls();\n\n    // Hide the \"No posts\" message.\n    this.noPosts.hide();\n  }\n\n  /**\n   * Returns an image Card element for the image with the given URL.\n   */\n  static createImageCard(postId, thumbUrl, text) {\n    const element = $(`\n          <a class=\"fp-image mdl-cell mdl-cell--12-col mdl-cell--4-col-tablet\n                    mdl-cell--4-col-desktop mdl-grid mdl-grid--no-spacing\">\n              <div class=\"fp-overlay\">\n                  <i class=\"material-icons\">favorite</i><span class=\"likes\">0</span>\n                  <i class=\"material-icons\">mode_comment</i><span class=\"comments\">0</span>\n                  <div class=\"fp-pic-text\"/>\n              </div>\n              <div class=\"mdl-card mdl-shadow--2dp mdl-cell\n                          mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop\"></div>\n          </a>`);\n    $('.fp-pic-text', element).text(text);\n    element.attr('href', `/post/${postId}`);\n    element.addClass(`fp-post-${postId}`);\n    // Display the thumbnail.\n    $('.mdl-card', element).css('background-image', `url(\"${thumbUrl.replace(/\"/g, '\\\\\"')}\")`);\n    // Start listening for comments and likes counts.\n    friendlyPix.firebase.registerForLikesCount(postId,\n        nbLikes => $('.likes', element).text(nbLikes));\n    friendlyPix.firebase.registerForCommentsCount(postId,\n        nbComments => $('.comments', element).text(nbComments));\n\n    return element;\n  }\n\n  /**\n   * Returns an image Card element for the image with the given URL.\n   */\n  static createProfileCardHtml(uid, profilePic = '/images/silhouette.jpg', fullName = 'Anonymous') {\n    fullName = friendlyPix.MaterialUtils.escapeHtml(fullName);\n    return `\n        <a class=\"fp-usernamelink mdl-button mdl-js-button\" href=\"/user/${uid}\">\n            <div class=\"fp-avatar\" style=\"background-image: url('${profilePic}')\"></div>\n            <div class=\"fp-username mdl-color-text--black\">${fullName}</div>\n        </a>`;\n  }\n};\n\nfriendlyPix.userPage = new friendlyPix.UserPage();\n"]}