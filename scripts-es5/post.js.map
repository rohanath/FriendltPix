{"version":3,"sources":["../scripts/post.js"],"names":["window","friendlyPix","Post","postId","timers","database","firebase","storage","auth","$","document","ready","postPage","postElement","createPostHtml","MaterialUtils","upgradeTextFields","toast","theatre","getPostData","then","post","snapshot","val","clear","data","message","timeout","MaterialSnackbar","showSnackbar","currentUser","page","uid","fillPostData","key","thumb_url","url","text","author","timestamp","thumb_storage_uri","full_storage_uri","full_url","forEach","clearInterval","timer","cancelAllSubscriptions","comments","commentsIds","Object","keys","i","length","displayComment","comment","commentId","prepend","newElement","createComment","userId","append","upgradeDropdowns","subscribeToComment","updatedComment","snap","updatedElement","element","replaceWith","remove","nextPage","nextPageButton","show","unbind","prop","click","displayComments","entries","displayNextPageButton","hide","thumbUrl","imageText","thumbStorageUri","picStorageUri","picUrl","attr","css","profile_picture","full_name","_setupThumb","registerForThumbChanges","_setupDate","_setupDeleteButton","_setupReportButton","_setupLikeCountAndStatus","_setupComments","off","leaveTheatreMode","keydown","e","which","replace","enterTheatreMode","getTimeText","push","setInterval","empty","getComments","commentIds","subscribeToComments","commentData","submit","preventDefault","commentText","addComment","ran","Math","floor","random","swal","title","type","showCancelButton","confirmButtonColor","confirmButtonText","closeOnConfirm","showLoaderOnConfirm","allowEscapeKey","reportPost","catch","close","error","addClass","removeClass","deletePost","registerToUserLike","isliked","updateLike","registerForLikesCount","nbLikes","isOwner","escapeHtml","html","confirm","deleteComment","reportComment","newComment","prompt","editComment","console","postCreationTimestamp","millis","Date","now","ms","secs","mins","hrs","days","timeSinceCreation","timeText"],"mappings":"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","file":"post.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the single post UI.\n */\nfriendlyPix.Post = class {\n  /**\n   * Initializes the single post's UI.\n   * @constructor\n   */\n  constructor(postId) {\n    // List of all times running on the page.\n    this.timers = [];\n\n    // Firebase SDK.\n    this.database = firebase.database();\n    this.storage = firebase.storage();\n    this.auth = firebase.auth();\n\n    $(document).ready(() => {\n      this.postPage = $('#page-post');\n      // Pointers to DOM elements.\n      this.postElement = $(friendlyPix.Post.createPostHtml(postId));\n      friendlyPix.MaterialUtils.upgradeTextFields(this.postElement);\n      this.toast = $('.mdl-js-snackbar');\n      this.theatre = $('.fp-theatre');\n    });\n  }\n\n  /**\n   * Loads the given post's details.\n   */\n  loadPost(postId) {\n    // Load the posts information.\n    friendlyPix.firebase.getPostData(postId).then(snapshot => {\n      const post = snapshot.val();\n      // Clear listeners and previous post data.\n      this.clear();\n      if (!post) {\n        const data = {\n          message: 'This post does not exists.',\n          timeout: 5000\n        };\n        this.toast[0].MaterialSnackbar.showSnackbar(data);\n        if (this.auth.currentUser) {\n          page(`/user/${this.auth.currentUser.uid}`);\n        } else {\n          page(`/feed`);\n        }\n      } else {\n        this.fillPostData(snapshot.key, post.thumb_url || post.url, post.text, post.author,\n            post.timestamp, post.thumb_storage_uri, post.full_storage_uri, post.full_url);\n      }\n    });\n  }\n\n  /**\n   * Clears all listeners and timers in the given element.\n   */\n  clear() {\n    // Stops all timers if any.\n    this.timers.forEach(timer => clearInterval(timer));\n    this.timers = [];\n\n    // Remove Firebase listeners.\n    friendlyPix.firebase.cancelAllSubscriptions();\n  }\n\n  /**\n   * Displays the given list of `comments` in the post.\n   */\n  displayComments(postId, comments) {\n    const commentsIds = Object.keys(comments);\n    for (let i = commentsIds.length - 1; i >= 0; i--) {\n      this.displayComment(comments[commentsIds[i]], postId, commentsIds[i]);\n    }\n  }\n\n  /**\n   * Displays a single comment or replace the existing one with new content.\n   */\n  displayComment(comment, postId, commentId, prepend = true) {\n    const newElement = this.createComment(comment.author, comment.text, postId,\n        commentId, comment.author.uid === friendlyPix.auth.userId);\n    if (prepend) {\n      $('.fp-comments', this.postElement).prepend(newElement);\n    } else {\n      $('.fp-comments', this.postElement).append(newElement);\n    }\n    friendlyPix.MaterialUtils.upgradeDropdowns(this.postElement);\n\n    // Subscribe to updates of the comment.\n    friendlyPix.firebase.subscribeToComment(postId, commentId, snap => {\n      const updatedComment = snap.val();\n      if (updatedComment) {\n        const updatedElement = this.createComment(updatedComment.author,\n          updatedComment.text, postId, commentId,\n          updatedComment.author.uid === friendlyPix.auth.userId);\n        const element = $('#comment-' + commentId);\n        element.replaceWith(updatedElement);\n      } else {\n        $('#comment-' + commentId).remove();\n      }\n      friendlyPix.MaterialUtils.upgradeDropdowns(this.postElement);\n    });\n  }\n\n  /**\n   * Shows the \"show more comments\" button and binds it the `nextPage` callback. If `nextPage` is\n   * `null` then the button is hidden.\n   */\n  displayNextPageButton(postId, nextPage) {\n    const nextPageButton = $('.fp-morecomments', this.postElement);\n    if (nextPage) {\n      nextPageButton.show();\n      nextPageButton.unbind('click');\n      nextPageButton.prop('disabled', false);\n      nextPageButton.click(() => nextPage().then(data => {\n        nextPageButton.prop('disabled', true);\n        this.displayComments(postId, data.entries);\n        this.displayNextPageButton(postId, data.nextPage);\n      }));\n    } else {\n      nextPageButton.hide();\n    }\n  }\n\n  /**\n   * Fills the post's Card with the given details.\n   * Also sets all auto updates and listeners on the UI elements of the post.\n   */\n  fillPostData(postId, thumbUrl, imageText, author = {}, timestamp, thumbStorageUri, picStorageUri, picUrl) {\n    const post = this.postElement;\n\n    friendlyPix.MaterialUtils.upgradeDropdowns(this.postElement);\n\n    // Fills element's author profile.\n    $('.fp-usernamelink', post).attr('href', `/user/${author.uid}`);\n    $('.fp-avatar', post).css('background-image',\n        `url(${author.profile_picture || '/images/silhouette.jpg'})`);\n    $('.fp-username', post).text(author.full_name || 'Anonymous');\n\n    // Shows the pic's thumbnail.\n    this._setupThumb(thumbUrl, picUrl);\n\n    // Make sure we update if the thumb or pic URL changes.\n    friendlyPix.firebase.registerForThumbChanges(postId, thumbUrl => {\n      this._setupThumb(thumbUrl, picUrl);\n    });\n\n    this._setupDate(postId, timestamp);\n    this._setupDeleteButton(postId, author, picStorageUri, thumbStorageUri);\n    this._setupReportButton(postId);\n    this._setupLikeCountAndStatus(postId);\n    this._setupComments(postId, author, imageText);\n    return post;\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  leaveTheatreMode() {\n    this.theatre.hide();\n    this.theatre.off('click');\n    $(document).off('keydown');\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  enterTheatreMode(picUrl) {\n    $('.fp-fullpic', this.theatre).prop('src', picUrl);\n    this.theatre.css('display', 'flex');\n    // Leave theatre mode if click or ESC key down.\n    this.theatre.off('click');\n    this.theatre.click(() => this.leaveTheatreMode());\n    $(document).off('keydown');\n    $(document).keydown(e => {\n      if (e.which === 27) {\n        this.leaveTheatreMode();\n      }\n    });\n  }\n\n  /**\n   * Shows the thumbnail and sets up the click to see the full size image.\n   * @private\n   */\n  _setupThumb(thumbUrl, picUrl) {\n    const post = this.postElement;\n\n    $('.fp-image', post).css('background-image', `url(\"${thumbUrl ? thumbUrl.replace(/\"/g, '\\\\\"') : ''}\")`);\n    $('.fp-image', post).unbind('click');\n    $('.fp-image', post).click(() => this.enterTheatreMode(picUrl || thumbUrl));\n  }\n\n  /**\n   * Shows the publishing date of the post and updates this date live.\n   * @private\n   */\n  _setupDate(postId, timestamp) {\n    const post = this.postElement;\n\n    $('.fp-time', post).attr('href', `/post/${postId}`);\n    $('.fp-time', post).text(friendlyPix.Post.getTimeText(timestamp));\n    // Update the time counter every minutes.\n    this.timers.push(setInterval(\n        () => $('.fp-time', post).text(friendlyPix.Post.getTimeText(timestamp)), 60000));\n  }\n\n  /**\n   * Shows comments and binds actions to the comments form.\n   * @private\n   */\n  _setupComments(postId, author, imageText) {\n    const post = this.postElement;\n\n    // Creates the initial comment with the post's text.\n    $('.fp-first-comment', post).empty();\n    $('.fp-first-comment', post).append(this.createComment(author, imageText));\n\n    // Load first page of comments and listen to new comments.\n    friendlyPix.firebase.getComments(postId).then(data => {\n      $('.fp-comments', post).empty();\n      this.displayComments(postId, data.entries);\n      this.displayNextPageButton(postId, data.nextPage);\n\n      // Display any new comments.\n      const commentIds = Object.keys(data.entries);\n      friendlyPix.firebase.subscribeToComments(postId, (commentId, commentData) => {\n        this.displayComment(commentData, postId, commentId, false);\n      }, commentIds ? commentIds[commentIds.length - 1] : 0);\n    });\n\n    if (this.auth.currentUser) {\n      // Bind comments form posting.\n      $('.fp-add-comment', post).off('submit');\n      $('.fp-add-comment', post).submit(e => {\n        e.preventDefault();\n        const commentText = $(`.mdl-textfield__input`, post).val();\n        if (!commentText || commentText.length === 0) {\n          return;\n        }\n        friendlyPix.firebase.addComment(postId, commentText);\n        $(`.mdl-textfield__input`, post).val('');\n      });\n      const ran = Math.floor(Math.random() * 10000000);\n      $('.mdl-textfield__input', post).attr('id', `${postId}-${ran}-comment`);\n      $('.mdl-textfield__label', post).attr('for', `${postId}-${ran}-comment`);\n      // Show comments form.\n      $('.fp-action', post).css('display', 'flex');\n    }\n  }\n\n  /**\n   * Binds the action to the report button.\n   * @private\n   */\n  _setupReportButton(postId) {\n    const post = this.postElement;\n\n    if (this.auth.currentUser) {\n      $('.fp-report-post', post).show();\n      $('.fp-report-post', post).off('click');\n      $('.fp-report-post', post).click(() => {\n        swal({\n          title: 'Are you sure?',\n          text: 'You are about to flag this post for inappropriate content! An administrator will review your claim.',\n          type: 'warning',\n          showCancelButton: true,\n          confirmButtonColor: '#DD6B55',\n          confirmButtonText: 'Yes, report this post!',\n          closeOnConfirm: true,\n          showLoaderOnConfirm: true,\n          allowEscapeKey: true\n        }, () => {\n          $('.fp-report-post', post).prop('disabled', true);\n          friendlyPix.firebase.reportPost(postId).then(() => {\n            swal({\n              title: 'Reported!',\n              text: 'This post has been reported. Please allow some time before an admin reviews it.',\n              type: 'success',\n              timer: 2000\n            });\n            $('.fp-report-post', post).prop('disabled', false);\n          }).catch(error => {\n            swal.close();\n            $('.fp-report-post', post).prop('disabled', false);\n            const data = {\n              message: `There was an error reporting your post: ${error}`,\n              timeout: 5000\n            };\n            this.toast[0].MaterialSnackbar.showSnackbar(data);\n          });\n        });\n      });\n    }\n  }\n\n  /**\n   * Shows/Hide and binds actions to the Delete button.\n   * @private\n   */\n  _setupDeleteButton(postId, author = {}, picStorageUri, thumbStorageUri) {\n    const post = this.postElement;\n\n    if (this.auth.currentUser && this.auth.currentUser.uid === author.uid) {\n      post.addClass('fp-owned-post');\n    } else {\n      post.removeClass('fp-owned-post');\n    }\n\n    $('.fp-delete-post', post).off('click');\n    $('.fp-delete-post', post).click(() => {\n      swal({\n        title: 'Are you sure?',\n        text: 'You are about to delete this post. Once deleted, you will not be able to recover it!',\n        type: 'warning',\n        showCancelButton: true,\n        confirmButtonColor: '#DD6B55',\n        confirmButtonText: 'Yes, delete it!',\n        closeOnConfirm: false,\n        showLoaderOnConfirm: true,\n        allowEscapeKey: true\n      }, () => {\n        $('.fp-delete-post', post).prop('disabled', true);\n        friendlyPix.firebase.deletePost(postId, picStorageUri, thumbStorageUri).then(() => {\n          swal({\n            title: 'Deleted!',\n            text: 'Your post has been deleted.',\n            type: 'success',\n            timer: 2000\n          });\n          $('.fp-delete-post', post).prop('disabled', false);\n          page(`/user/${this.auth.currentUser.uid}`);\n        }).catch(error => {\n          swal.close();\n          $('.fp-delete-post', post).prop('disabled', false);\n          const data = {\n            message: `There was an error deleting your post: ${error}`,\n            timeout: 5000\n          };\n          this.toast[0].MaterialSnackbar.showSnackbar(data);\n        });\n      });\n    });\n  }\n\n  /**\n   * Starts Likes count listener and on/off like status.\n   * @private\n   */\n  _setupLikeCountAndStatus(postId) {\n    const post = this.postElement;\n\n    if (this.auth.currentUser) {\n      // Listen to like status.\n      friendlyPix.firebase.registerToUserLike(postId, isliked => {\n        if (isliked) {\n          $('.fp-liked', post).show();\n          $('.fp-not-liked', post).hide();\n        } else {\n          $('.fp-liked', post).hide();\n          $('.fp-not-liked', post).show();\n        }\n      });\n\n      // Add event listeners.\n      $('.fp-liked', post).off('click');\n      $('.fp-liked', post).click(() => friendlyPix.firebase.updateLike(postId, false));\n      $('.fp-not-liked', post).off('click');\n      $('.fp-not-liked', post).click(() => friendlyPix.firebase.updateLike(postId, true));\n    } else {\n      $('.fp-liked', post).hide();\n      $('.fp-not-liked', post).hide();\n      $('.fp-action', post).hide();\n    }\n\n    // Listen to number of Likes.\n    friendlyPix.firebase.registerForLikesCount(postId, nbLikes => {\n      if (nbLikes > 0) {\n        $('.fp-likes', post).show();\n        $('.fp-likes', post).text(nbLikes + ' like' + (nbLikes === 1 ? '' : 's'));\n      } else {\n        $('.fp-likes', post).hide();\n      }\n    });\n  }\n\n  /**\n   * Returns the HTML for a post's comment.\n   */\n  static createPostHtml(postId = 0) {\n    return `\n        <div class=\"fp-post mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet\n                    mdl-cell--8-col-desktop mdl-grid mdl-grid--no-spacing\">\n          <div class=\"mdl-card mdl-shadow--2dp mdl-cell\n                        mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop\">\n            <div class=\"fp-header\">\n              <a class=\"fp-usernamelink mdl-button mdl-js-button\" href=\"/user/\">\n                <div class=\"fp-avatar\"></div>\n                <div class=\"fp-username mdl-color-text--black\"></div>\n              </a>\n              <a href=\"/post/\" class=\"fp-time\">now</a>\n              <!-- Drop Down Menu -->\n              <button class=\"fp-signed-in-only mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon\" id=\"fp-post-menu-${postId}\">\n                <i class=\"material-icons\">more_vert</i>\n              </button>\n              <ul class=\"fp-menu-list mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right\" for=\"fp-post-menu-${postId}\">\n                <li class=\"mdl-menu__item fp-report-post\"><i class=\"material-icons\">report</i> Report</li>\n                <li class=\"mdl-menu__item fp-delete-post\"><i class=\"material-icons\">delete</i> Delete post</li>\n              </ul>\n            </div>\n            <div class=\"fp-image\"></div>\n            <div class=\"fp-likes\">0 likes</div>\n            <div class=\"fp-first-comment\"></div>\n            <div class=\"fp-morecomments\">View more comments...</div>\n            <div class=\"fp-comments\"></div>\n            <div class=\"fp-action\">\n              <span class=\"fp-like\">\n                <div class=\"fp-not-liked material-icons\">favorite_border</div>\n                <div class=\"fp-liked material-icons\">favorite</div>\n              </span>\n              <form class=\"fp-add-comment\" action=\"#\">\n                <div class=\"mdl-textfield mdl-js-textfield\">\n                  <input class=\"mdl-textfield__input\">\n                  <label class=\"mdl-textfield__label\">Comment...</label>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>`;\n  }\n\n  /**\n   * Returns the HTML for a post's comment.\n   */\n  createComment(author = {}, text, postId, commentId, isOwner = false) {\n    commentId = friendlyPix.MaterialUtils.escapeHtml(commentId);\n    try {\n      const element = $(`\n        <div id=\"comment-${commentId}\" class=\"fp-comment${isOwner ? ' fp-comment-owned' : ''}\">\n          <a class=\"fp-author\" href=\"/user/${author.uid}\">${$('<div>').text(author.full_name || 'Anonymous').html()}</a>:\n          <span class=\"fp-text\">${$('<div>').text(text).html()}</span>\n          <!-- Drop Down Menu -->\n          <button class=\"fp-edit-delete-comment-container fp-signed-in-only mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon\" id=\"fp-comment-menu-${commentId}\">\n            <i class=\"material-icons\">more_vert</i>\n          </button>\n          <ul class=\"fp-menu-list mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--top-right\" for=\"fp-comment-menu-${commentId}\">\n            <li class=\"mdl-menu__item fp-report-comment\"><i class=\"material-icons\">report</i> Report</li>\n            <li class=\"mdl-menu__item fp-edit-comment\"><i class=\"material-icons\">mode_edit</i> Edit</li>\n            <li class=\"mdl-menu__item fp-delete-comment\"><i class=\"material-icons\">delete</i> Delete comment</li>\n          </ul>\n        </div>`);\n      $('.fp-delete-comment', element).click(() => {\n        if (window.confirm('Delete the comment?')) {\n          friendlyPix.firebase.deleteComment(postId, commentId).then(() => {\n            element.text('this comment has been deleted');\n            element.addClass('fp-comment-deleted');\n          });\n        }\n      });\n      $('.fp-report-comment', element).click(() => {\n        if (window.confirm('Report this comment for inappropriate content?')) {\n          friendlyPix.firebase.reportComment(postId, commentId).then(() => {\n            element.text('this comment has been flagged for review.');\n            element.addClass('fp-comment-deleted');\n          });\n        }\n      });\n      $('.fp-edit-comment', element).click(() => {\n        const newComment = window.prompt('Edit the comment?', text);\n        if (newComment !== null && newComment !== '') {\n          friendlyPix.firebase.editComment(postId, commentId, newComment).then(() => {\n            $('.fp-text', element).text(newComment);\n          });\n        }\n      });\n      return element;\n    } catch (e) {\n      console.error('Error while displaying comment', e);\n    }\n    return $('<div/>');\n  }\n\n  /**\n   * Given the time of creation of a post returns how long since the creation of the post in text\n   * format. e.g. 5d, 10h, now...\n   */\n  static getTimeText(postCreationTimestamp) {\n    let millis = Date.now() - postCreationTimestamp;\n    const ms = millis % 1000;\n    millis = (millis - ms) / 1000;\n    const secs = millis % 60;\n    millis = (millis - secs) / 60;\n    const mins = millis % 60;\n    millis = (millis - mins) / 60;\n    const hrs = millis % 24;\n    const days = (millis - hrs) / 24;\n    const timeSinceCreation = [days, hrs, mins, secs, ms];\n\n    let timeText = 'Now';\n    if (timeSinceCreation[0] !== 0) {\n      timeText = timeSinceCreation[0] + 'd';\n    } else if (timeSinceCreation[1] !== 0) {\n      timeText = timeSinceCreation[1] + 'h';\n    } else if (timeSinceCreation[2] !== 0) {\n      timeText = timeSinceCreation[2] + 'm';\n    }\n    return timeText;\n  }\n};\n\nfriendlyPix.post = new friendlyPix.Post();\n\n$(document).ready(() => {\n  // We add the Post element to the single post page.\n  $('.fp-image-container', friendlyPix.post.postPage).append(friendlyPix.post.postElement);\n});\n"]}