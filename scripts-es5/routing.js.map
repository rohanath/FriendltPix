{"version":3,"sources":["../scripts/routing.js"],"names":["window","friendlyPix","Router","$","document","ready","pagesElements","splashLogin","location","pathname","page","pipe","displayPage","bind","loadUser","userPage","userId","showHomeFeed","feed","showGeneralFeed","clearFeed","clear","showPost","post","loadPost","postId","pageId","onlyAuthed","admin","attributes","context","enableAdminMode","disableAdminMode","auth","waitForAuth","then","_displayPage","firebase","currentUser","show","setLinkAsActive","canonicalPath","each","index","element","id","fadeOut","hide","MaterialUtils","closeDrawer","scrollToTop","path","body","classList","add","remove","animate","scrollTop","funct","attribute","optContinue","next","params","Object","keys","length","removeClass","addClass","router"],"mappings":"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","file":"routing.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the pages/routing.\n */\nfriendlyPix.Router = class {\n\n  /**\n   * Initializes the Friendly Pix controller/router.\n   * @constructor\n   */\n  constructor() {\n    $(document).ready(() => {\n      // Dom elements.\n      this.pagesElements = $('[id^=page-]');\n      this.splashLogin = $('#login', '#page-splash');\n\n      // Make sure /add is never opened on website load.\n      if (window.location.pathname === '/add') {\n        page('/');\n      }\n\n      // Configuring routes.\n      const pipe = friendlyPix.Router.pipe;\n      const displayPage = this.displayPage.bind(this);\n      const loadUser = userId => friendlyPix.userPage.loadUser(userId);\n      const showHomeFeed = () => friendlyPix.feed.showHomeFeed();\n      const showGeneralFeed = () => friendlyPix.feed.showGeneralFeed();\n      const clearFeed = () => friendlyPix.feed.clear();\n      const showPost = postId => friendlyPix.post.loadPost(postId);\n\n      page('/', pipe(showHomeFeed, null, true),\n          pipe(displayPage, {pageId: 'feed', onlyAuthed: true}));\n      page('/feed', pipe(showGeneralFeed, null, true), pipe(displayPage, {pageId: 'feed'}));\n      page('/post/:postId', pipe(showPost, null, true), pipe(displayPage, {pageId: 'post'}));\n      page('/post/:postId/admin', pipe(showPost, null, true), pipe(displayPage, {pageId: 'post', admin: true}));\n      page('/user/:userId', pipe(loadUser, null, true), pipe(displayPage, {pageId: 'user-info'}));\n      page('/about', pipe(clearFeed, null, true), pipe(displayPage, {pageId: 'about'}));\n      page('/terms', pipe(clearFeed, null, true), pipe(displayPage, {pageId: 'terms'}));\n      page('/add', pipe(displayPage, {pageId: 'add', onlyAuthed: true}));\n      page('*', () => page('/'));\n\n      // Start routing.\n      page();\n    });\n  }\n\n  /**\n   * Returns a function that displays the given page and hides the other ones.\n   * if `onlyAuthed` is set to true then the splash page will be displayed instead of the page if\n   * the user is not signed-in.\n   */\n  displayPage(attributes, context) {\n    const onlyAuthed = attributes.onlyAuthed;\n    const admin = attributes.admin;\n    if (admin) {\n      friendlyPix.Router.enableAdminMode();\n    } else {\n      friendlyPix.Router.disableAdminMode();\n    }\n\n    if (onlyAuthed) {\n      // If the pge can only be displayed if the user is authenticated then we wait or the auth state.\n      friendlyPix.auth.waitForAuth.then(() => {\n        this._displayPage(attributes, context);\n      });\n    } else {\n      this._displayPage(attributes, context);\n    }\n  }\n\n  _displayPage(attributes, context) {\n    const onlyAuthed = attributes.onlyAuthed;\n    let pageId = attributes.pageId;\n\n    if (onlyAuthed && !firebase.auth().currentUser) {\n      pageId = 'splash';\n      this.splashLogin.show();\n    }\n    friendlyPix.Router.setLinkAsActive(context.canonicalPath);\n    this.pagesElements.each(function(index, element) {\n      if (element.id === 'page-' + pageId) {\n        $(element).show();\n      } else if (element.id === 'page-splash' && onlyAuthed) {\n        $(element).fadeOut(1000);\n      } else {\n        $(element).hide();\n      }\n    });\n    friendlyPix.MaterialUtils.closeDrawer();\n    friendlyPix.Router.scrollToTop();\n  }\n\n  /**\n   * Reloads the current page.\n   */\n  reloadPage() {\n    let path = window.location.pathname;\n    if (path === '') {\n      path = '/';\n    }\n    page(path);\n  }\n\n  /**\n   * Turn the UI into admin mode.\n   */\n  static enableAdminMode() {\n    document.body.classList.add('fp-admin');\n  }\n\n  /**\n   * Switch off admin mode in the UI.\n   */\n  static disableAdminMode() {\n    document.body.classList.remove('fp-admin');\n  }\n\n  /**\n   * Scrolls the page to top.\n   */\n  static scrollToTop() {\n    $('html,body').animate({scrollTop: 0}, 0);\n  }\n\n  /**\n   * Pipes the given function and passes the given attribute and Page.js context.\n   * Set 'optContinue' to true if there are further functions to call.\n   */\n  static pipe(funct, attribute, optContinue) {\n    return (context, next) => {\n      if (funct) {\n        const params = Object.keys(context.params);\n        if (!attribute && params.length > 0) {\n          funct(context.params[params[0]], context);\n        } else {\n          funct(attribute, context);\n        }\n      }\n      if (optContinue) {\n        next();\n      }\n    };\n  }\n\n  /**\n   * Highlights the correct menu item/link.\n   */\n  static setLinkAsActive(canonicalPath) {\n    if (canonicalPath === '') {\n      canonicalPath = '/';\n    }\n    $('.is-active').removeClass('is-active');\n    $(`[href=\"${canonicalPath}\"]`).addClass('is-active');\n  }\n};\n\nfriendlyPix.router = new friendlyPix.Router();\n"]}